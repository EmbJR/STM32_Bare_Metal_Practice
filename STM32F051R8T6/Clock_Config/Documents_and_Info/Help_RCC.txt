- The reset source can be identified by checking the reset flags in the Control/Status register,
RCC_CSR

- There are two ways to generate a low-power management reset:
1. Reset generated when entering Standby mode:
This type of reset is enabled by resetting nRST_STDBY bit in User Option Bytes. In this
case, whenever a Standby mode entry sequence is successfully executed, the device
is reset instead of entering Standby mode.

2. Reset when entering Stop mode:
This type of reset is enabled by resetting nRST_STOP bit in User Option Bytes. In this
case, whenever a Stop mode entry sequence is successfully executed, the device is
reset instead of entering Stop mode


<<--------------------------- RTC start ---------------------------------->>
The Backup registers are also reset when one of the following events occurs:
1. RTC tamper detection event.
2. Change of the read out protection from level 1 to level 0
<<--------------------------- RTC ends ---------------------------------->>

<<--------------------------- Clock start ---------------------------------->>
Various clock sources can be used to drive the system clock (SYSCLK):
• HSI 8 MHz RC oscillator clock
• HSE oscillator clock
• PLL clock
• HSI48 48 MHz RC oscillator clock (available on STM32F04x, STM32F07x and

STM32F09x devices only)
The devices have the following additional clock sources:
• 40 kHz low speed internal RC (LSI RC) which drives the independent watchdog and
optionally the RTC used for Auto-wake-up from Stop/Standby mode.
• 32.768 kHz low speed external crystal (LSE crystal) which optionally drives the real-
time clock (RTCCLK)
• 14 MHz high speed internal RC (HSI14) dedicated for ADC.
Each clock source can be switched on or off independently when it is not used, to optimize
power consumption.
Several prescalers can be used to configure the frequency of the AHB and the APB
domains. The AHB and the APB domains maximum frequency is 48 MHz.

All the peripheral clocks are derived from their bus clock (HCLK for AHB or PCLK for APB)
except:
• The Flash memory programming interface clock (FLITFCLK) which is always the HSI
clock.
• The option byte loader clock which is always the HSI clock
• The ADC clock which is derived (selected by software) from one of the two following
sources:
– dedicated HSI14 clock, to run always at the maximum sampling rate
– APB clock (PCLK) divided by 2 or 4
• The USART1 clock, USART2 clock (on STM32F07x and STM32F09x devices only)
and USART3 clock (on STM32F09x devices only) which is derived (selected by
software) from one of the four following sources:
– system clock
– HSI clock
– LSE clock
– APB clock (PCLK)
• The I2C1 clock which is derived (selected by software) from one of the two following
sources:
– system clock
– HSI clock
• The USB clock which is derived (selected by software) from one of the two following
sources:
– PLL clock
– HSI48 clock
• The CEC clock which is derived from the HSI clock divided by 244 or from the LSE
clock.
• The I2S1 and I2S2 clock which is always the system clock.
• The RTC clock which is derived from the LSE, LSI or from the HSE clock divided by 32.
• The timer clock frequencies are automatically fixed by hardware. There are two cases:
– if the APB prescaler is 1, the timer clock frequencies are set to the same
frequency as that of the APB domain;
– otherwise, they are set to twice (x2) the frequency of the APB domain.
• The IWDG clock which is always the LSI clock.
The RCC feeds the Cortex System Timer (SysTick) external clock with the AHB clock
(HCLK) divided by 8. The SysTick can work either with this clock or directly with the Cortex
clock (HCLK), configurable in the SysTick Control and Status Register.


>> HSE clock
The high speed external clock signal (HSE) can be generated from two possible clock
sources:
• HSE external crystal/ceramic resonator
• HSE user external clock
The resonator and the load capacitors have to be placed as close as possible to the
oscillator pins in order to minimize output distortion and startup stabilization time. The
loading capacitance values must be adjusted according to the selected oscillator

>> External crystal/ceramic resonator (HSE crystal)
The 4 to 32 MHz external oscillator has the advantage of producing a very accurate rate on
the main clock.
The associated hardware configuration is shown in Figure 12. Refer to the electrical
characteristics section of the datasheet for more details.
The HSERDY flag in the Clock control register (RCC_CR) indicates if the HSE oscillator is
stable or not. At startup, the clock is not released until this bit is set by hardware. An
interrupt can be generated if enabled in the Clock interrupt register (RCC_CIR).
The HSE Crystal can be switched on and off using the HSEON bit in the Clock control
register (RCC_CR).
For code example refer to the Appendix section
---------------------------------------------------------
Caution: To switch ON the HSE oscillator, 512 HSE clock pulses need to be seen by an internal
stabilization counter after the HSEON bit is set. Even in the case that no crystal or resonator
is connected to the device, excessive external noise on the OSC_IN pin may still lead the
oscillator to start. Once the oscillator is started, it needs another 6 HSE clock pulses to
complete a switching OFF sequence. If for any reason the oscillations are no more present
on the OSC_IN pin, the oscillator cannot be switched OFF, locking the OSC pins from any
other use and introducing unwanted power consumption. To avoid such situation, it is
strongly recommended to always enable the Clock Security System (CSS) which is able to
switch OFF the oscillator even in this case.
------------------------
>> External source (HSE bypass)
In this mode, an external clock source must be provided. It can have a frequency of up to
32 MHz. You select this mode by setting the HSEBYP and HSEON bits in the Clock control
register (RCC_CR). The external clock signal (square, sinus or triangle) with ~40-60% duty
cycle depending on the frequency (refer to the datasheet) has to drive the OSC_IN pin while
the OSC_OUT pin can be used a GPIO. See Figure 12.

---------------------------------------------------------------------
>> HSI clock
The HSI clock signal is generated from an internal 8 MHz RC oscillator and can be used
directly as a system clock or for PLL input
The HSI RC oscillator has the advantage of providing a clock source at low cost (no external
components). It also has a faster startup time than the HSE crystal oscillator however, even
with calibration the frequency is less accurate than an external crystal oscillator or ceramic
resonator.

>> Calibration
RC oscillator frequencies can vary from one chip to another due to manufacturing process
variations, this is why each device is factory calibrated by ST for 1% accuracy at TA=25°C.
After reset, the factory calibration value is loaded in the HSICAL[7:0] bits in the Clock control
register (RCC_CR).
If the application is subject to voltage or temperature variations this may affect the RC
oscillator speed. You can trim the HSI frequency in the application using the HSITRIM[4:0]
bits in the Clock control register (RCC_CR)

For more details on how to measure the HSI frequency variation refer to Section 6.2.13:
Internal/external clock measurement with TIM14 on page 107.
The HSIRDY flag in the Clock control register (RCC_CR) indicates if the HSI RC is stable or
not. At startup, the HSI RC output clock is not released until this bit is set by hardware.
The HSI RC can be switched on and off using the HSION bit in the Clock control register
(RCC_CR).
The HSI signal can also be used as a backup source (Auxiliary clock) if the HSE crystal
oscillator fails. Refer to Section 6.2.8: Clock security system (CSS) on page 105.
Furthermore it is possible to drive the HSI clock to the MCO multiplexer. Then the clock
could be driven to the Timer 14 giving the ability to the user to calibrate the oscillator.
------------------------------------------------------------------------------------------

>> HSI48 clock
On STM32F04x, STM32F07x and STM32F09x devices only, the HSI48 clock signal is
generated from an internal 48 MHz RC oscillator and can be used directly as a system clock
or divided and be used as PLL input.
The internal 48MHz RC oscillator is mainly dedicated to provide a high precision clock to the
USB peripheral by means of a special Clock recovery system (CRS) circuitry, which could
use the USB SOF signal or the LSE or an external signal to automatically adjust the
oscillator frequency on-fly, in a very small steps. This oscillator can also be used as a
system clock source when the system is in run mode; it is disabled as soon as the system
enters in Stop or Standby mode. When the CRS is not used, the HSI48 RC oscillator runs on
its default frequency which is subject to manufacturing process variations, this is why each
device is factory calibrated by ST for ~3% accuracy at TA = 25 °C.
For more details on how to configure and use the CRS peripheral refer to Section 7.
The HSI48RDY flag in the Clock control register (RCC_CR) indicates if the HSI48 RC is
stable or not. At startup, the HSI48 RC output clock is not released until this bit is set by
hardware.

The HSI48 RC can be switched on and off using the HSI48ON bit in the Clock control
register (RCC_CR). This oscillator is also automatically enabled (by hardware forcing
HSI48ON bit to one) as soon as it is chosen as a clock source for the USB and the
peripheral is enabled.
Furthermore it is possible to drive the HSI48 clock to the MCO multiplexer and use it as a
clock source for other application components.
------------------------------------------------------------------
>> PLL
The internal PLL can be used to multiply the HSI, a divided HSI48 or the HSE output clock
frequency. Refer to Figure 9: Simplified diagram of the reset circuit, Figure 12: HSE/ LSE
clock sources and Clock control register (RCC_CR).
The PLL configuration (selection of the input clock, predivider and multiplication factor) must
be done before enabling the PLL. Once the PLL is enabled, these parameters cannot be
changed

To modify the PLL configuration, proceed as follows:
1. Disable the PLL by setting PLLON to 0.
2. Wait until PLLRDY is cleared. The PLL is now fully stopped.
3. Change the desired parameter.
4. Enable the PLL again by setting PLLON to 1.
5. Wait until PLLRDY is set.
An interrupt can be generated when the PLL is ready, if enabled in the Clock interrupt
register (RCC_CIR).
The PLL output frequency must be set in the range 16-48 MHz.
For code example refer to the Appendix section A.3.2: PLL configuration modification code
example
---------------------------------------------------------

>> LSE clock
The LSE crystal is a 32.768 kHz Low Speed External crystal or ceramic resonator. It has the
advantage of providing a low-power but highly accurate clock source to the real-time clock
peripheral (RTC) for clock/calendar or other timing functions.
The LSE crystal is switched on and off using the LSEON bit in RTC domain control register
(RCC_BDCR). The crystal oscillator driving strength can be changed at runtime using the
LSEDRV[1:0] bits in the RTC domain control register (RCC_BDCR) to obtain the best
compromise between robustness and short start-up time on one side and low-power
consumption on the other.
The LSERDY flag in the RTC domain control register (RCC_BDCR) indicates whether the
LSE crystal is stable or not. At startup, the LSE crystal output clock signal is not released
until this bit is set by hardware. An interrupt can be generated if enabled in the Clock
interrupt register (RCC_CIR).

>> Caution: To switch ON the LSE oscillator, 4096 LSE clock pulses need to be seen by an internal
stabilization counter after the LSEON bit is set. Even in the case that no crystal or resonator
is connected to the device, excessive external noise on the OSC32_IN pin may still lead the
oscillator to start. Once the oscillator is started, it needs another 6 LSE clock pulses to
complete a switching OFF sequence. If for any reason the oscillations are no more present
on the OSC_IN pin, the oscillator cannot be switched OFF, locking the OSC32 pins from any
other use and introducing unwanted power consumption. The only way to recover such
situation is to perform the RTC domain reset by software

>> External source (LSE bypass)
In this mode, an external clock source must be provided. It can have a frequency of up to
1 MHz. You select this mode by setting the LSEBYP and LSEON bits in the RTC domain
control register (RCC_BDCR). The external clock signal (square, sinus or triangle) with
~50% duty cycle has to drive the OSC32_IN pin while the OSC32_OUT pin can be used as
GPIO. See Figure 12
-------------------------------------------------------------------------------
>> LSI clock
The LSI RC acts as a low-power clock source that can be kept running in Stop and Standby
mode for the independent watchdog (IWDG) and RTC. The clock frequency is around 40
kHz. For more details, refer to the electrical characteristics section of the datasheets

The LSI RC can be switched on and off using the LSION bit in the Control/status register
(RCC_CSR).
The LSIRDY flag in the Control/status register (RCC_CSR) indicates if the LSI oscillator is
stable or not. At startup, the clock is not released until this bit is set by hardware. An
interrupt can be generated if enabled in the Clock interrupt register (RCC_CIR)
------------------------------------------------------------------------------------
System clock (SYSCLK) selection
Various clock sources can be used to drive the system clock (SYSCLK):
• HSI oscillator
• HSE oscillator
• PLL
• HSI48 oscillator (available only on STM32F04x, STM32F07x and STM32F09x devices)
After a system reset, the HSI oscillator is selected as system clock. When a clock source is
used directly or through the PLL as a system clock, it is not possible to stop it.
A switch from one clock source to another occurs only if the target clock source is ready
(clock stable after startup delay or PLL locked). If a clock source which is not yet ready is
selected, the switch will occur when the clock source becomes ready. Status bits in the
Clock control register (RCC_CR) indicate which clock(s) is (are) ready and which clock is
currently used as a system clock.
-----------------------------------------------------------------------------------
>> Clock security system (CSS)
Clock security system can be activated by software. In this case, the clock detector is
enabled after the HSE oscillator startup delay, and disabled when this oscillator is stopped.
If a failure is detected on the HSE clock, the HSE oscillator is automatically disabled, a clock
failure event is sent to the break input of the advanced-control timers (TIM1) and general-
purpose timers (TIM15, TIM16 and TIM17) and an interrupt is generated to inform the
software about the failure (clock security system interrupt, or CSSI), allowing the MCU to
perform rescue operations. The CSSI is linked to the Cortex®-M0 NMI (Non-Maskable
Interrupt) exception vector.

>> Note: Once the CSS is enabled and if the HSE clock fails, the CSS interrupt occurs and an NMI is
automatically generated. The NMI is executed indefinitely unless the CSS interrupt pending
bit is cleared. As a consequence, in the NMI ISR user must clear the CSS interrupt by
setting the CSSC bit in the Clock interrupt register (RCC_CIR).
If the HSE oscillator is used directly or indirectly as the system clock (indirectly means: it is
used as PLL input clock, and the PLL clock is used as system clock), a detected failure
causes a switch of the system clock to the HSI oscillator and the disabling of the HSE
oscillator. If the HSE clock (divided or not) is the clock entry of the PLL used as system clock
when the failure occurs, the PLL is disabled too.

---------------------------------------------------------------------------------
>> ADC clock
The ADC clock selection is done inside the ADC_CFGR2 (refer to Section 13.11.5: ADC
configuration register 2 (ADC_CFGR2) on page 271). It can be either the dedicated 14 MHz
RC oscillator (HSI14) connected on the ADC asynchronous clock input or PCLK divided by
2 or 4. The 14 MHz RC oscillator can be configured by software either to be turned on/off
(“auto-off mode”) by the ADC interface or to be always enabled. The HSI 14 MHz RC oscillator cannot be turned on by ADC interface when the APB clock is selected as an ADC
kernel clock.
------------------------------------------------------------------------------------
>> RTC clock
The RTCCLK clock source can be either the HSE/32, LSE or LSI clocks. This is selected by
programming the RTCSEL[1:0] bits in the RTC domain control register (RCC_BDCR). This
selection cannot be modified without resetting the RTC domain. The system must be always
configured in a way that the PCLK frequency is greater then or equal to the RTCCLK
frequency for proper operation of the RTC.
The LSE clock is in the RTC domain, whereas the HSE and LSI clocks are not.
Consequently:
• If LSE is selected as RTC clock:
    – The RTC continues to work even if the V DD supply is switched off, provided the
        V BAT supply is maintained.
    – The RTC remains clocked and functional under system reset
• If LSI is selected as the RTC clock:
    – The RTC state is not guaranteed if the VDD supply is powered off. Refer to
        Section 6.2.6: LSI clock on page 104 for more details on LSI calibration.
• If the HSE clock divided by 32 is used as the RTC clock:
    – The RTC state is not guaranteed if the VDD supply is powered off or if the internal
        voltage regulator is powered off (removing power from the 1.8 V domain).
        When the RTC clock is LSE, the RTC remains clocked and functional under system reset
--------------------------------------------------------------------------------------

>> Independent watchdog clock
If the Independent watchdog (IWDG) is started by either hardware option or software
access, the LSI oscillator is forced ON and cannot be disabled. After the LSI oscillator
temporization, the clock is provided to the IWDG.

>> Clock-out capability
The microcontroller clock output (MCO) capability allows the clock to be output onto the
external MCO pin. The configuration registers of the corresponding GPIO port must be
programmed in alternate function mode. One of the following clock signals can be selected
as the MCO clock:
• HSI14
• SYSCLK
• HSI
• HSE
• PLL clock divided by 2 or direct (direct connection is not available on STM32F05x
devices)
• LSE
• LSI
• HSI48 (on STM32F04x, STM32F07x and STM32F09x devices only)
The selection is controlled by the MCO[3:0] bits of the Clock configuration register
(RCC_CFGR).
For code example refer to the Appendix section A.3.3: MCO selection code example.
On STM32F03x, STM32F04x, STM32F07x and STM32F09x devices, the additional bit
PLLNODIV of this register controls the divider bypass for a PLL clock input to MCO. The
MCO frequency can be reduced by a configurable binary divider, controlled by the
MCOPRE[2..0] bits of the Clock configuration register (RCC_CFGR).
---------------------------------------------------------------------------------
>> Internal/external clock measurement with TIM14
It is possible to indirectly measure the frequency of all on-board clock sources by mean of
the TIM14 channel 1 input capture. As represented on Figure 13

The input capture channel of the Timer 14 can be a GPIO line or an internal clock of the
MCU. This selection is performed through the TI1_RMP [1:0] bits in the TIM14_OR register.
The possibilities available are the following ones.
• TIM14 Channel1 is connected to the GPIO. Refer to the alternate function mapping in
    the device datasheets.
• TIM14 Channel1 is connected to the RTCCLK.
• TIM14 Channel1 is connected to the HSE/32 Clock.
• TIM14 Channel1 is connected to the microcontroller clock output (MCO). Refer to
    Section 6.2.12: Clock-out capability for MCO clock configuration.

For code example refer to the Appendix section A.3.4: Clock measurement configuration
with TIM14 code example.
---------------------------------------------------------------------------------
>> Calibration of the HSI
The primary purpose of connecting the LSE, through the MCO multiplexer, to the channel 1
input capture is to be able to precisely measure the HSI system clocks (for this, the HSI
should be used as the system clock source). The number of HSI clock counts between
consecutive edges of the LSE signal provides a measure of the internal clock period. Taking
advantage of the high precision of LSE crystals (typically a few tens of ppm), it is possible to
determine the internal clock frequency with the same resolution, and trim the source to
compensate for manufacturing-process- and/or temperature- and voltage-related frequency
deviations.
The HSI oscillator has dedicated user-accessible calibration bits for this purpose.
The basic concept consists in providing a relative measurement (e.g. the HSI/LSE ratio): the
precision is therefore closely related to the ratio between the two clock sources. The higher
the ratio is, the better the measurement is.
If LSE is not available, HSE/32 is the better option in order to reach the most precise
calibration possible
----------------------------------------------------------------------------------
>> Calibration of the LSI
The calibration of the LSI will follow the same pattern that for the HSI, but changing the
reference clock. It is necessary to connect LSI clock to the channel 1 input capture of the
TIM14. Then define the HSE as system clock source, the number of its clock counts
between consecutive edges of the LSI signal provides a measure of the internal low speed
clock period.
The basic concept consists in providing a relative measurement (e.g. the HSE/LSI ratio): the
precision is therefore closely related to the ratio between the two clock sources. The higher
the ratio is, the better the measurement is.
-------------------------------------------------------------------------------------
>> Calibration of the HSI14
For the HSI14, because of its high frequency, it is not possible to have a precise resolution.
However a solution could be to clock Timer 14 with HSE through PLL to reach 48 MHz, and
to use the input capture line with the HSI14 and the capture prescaler defined to the higher
value. In that configuration, we got a ratio of 27 events. It is still a bit low to have an accurate
calibration. In order to increase the measure accuracy, it is advised to count the HSI periods
after multiple cycles of Timer 14. Using polling to treat the capture event is necessary in this
case.
-------------------------------------------------------------------------------------
>> Low-power modes
APB peripheral clocks and DMA clock can be disabled by software.
Sleep mode stops the CPU clock. The memory interface clocks (Flash and RAM interfaces)
can be stopped by software during sleep mode. The AHB to APB bridge clocks are disabled
by hardware during Sleep mode when all the clocks of the peripherals connected to them
are disabled.
Stop mode stops all the clocks in the core supply domain and disables the PLL and the HSI,
HSI48, HSI14 and HSE oscillators.
HDMI CEC, USART1, USART2 (only on STM32F07x and STM32F09x devices), USART3
(only on STM32F09x devices) and I2C1 have the capability to enable the HSI oscillator
even when the MCU is in Stop mode (if HSI is selected as the clock source for that
peripheral). When the system is in Stop mode, with the regulator in LP mode, the clock
request coming from any of those three peripherals moves the regulator to MR mode in
order to have the proper current drive capability for the core logic. The regulator moves back
to LP mode once this request is removed without waking up the MCU.
HDMI CEC, USART1, USART2 (only on STM32F07x and STM32F09x devices) and
USART3 (only on STM32F09x devices) can also be driven by the LSE oscillator when the
system is in Stop mode (if LSE is selected as clock source for that peripheral) and the LSE
oscillator is enabled (LSEON) but they do not have the capability to turn on the LSE
oscillator.
Standby mode stops all the clocks in the core supply domain and disables the PLL and the
HSI, HSI48, HSI14 and HSE oscillators.
The CPU’s deepsleep mode can be overridden for debugging by setting the DBG_STOP or
DBG_STANDBY bits in the DBGMCU_CR register.

When waking up from deepsleep after an interrupt (Stop mode) or reset (Standby mode),
the HSI oscillator is selected as system clock.
If a Flash programming operation is on going, deepsleep mode entry is delayed until the
Flash interface access is finished. If an access to the APB domain is ongoing, deepsleep
mode entry is delayed until the APB access is finished.
----------------------------------------------------------------------------------
>> RCC registers
Refer to Section 1.2 on page 42 for a list of abbreviations used in register descriptions.

>> Clock control register (RCC_CR)
Address offset: 0x00
Reset value: 0x0000 XX83 where X is undefined.
Access: no wait state, word, half-word and byte access
#----------------------- "TL1" start ----------------------
Bit 31: Reserved
Bit 30: Reserved
Bit 29: Reserved
Bit 28: Reserved
Bit 27: Reserved
Bit 26: Reserved
Bit 25: PLLRDY
Bit 24: PLLON
Bit 23: Reserved
Bit 22: Reserved
Bit 21: Reserved
Bit 20: Reserved
Bit 19: CSSON
Bit 18: HSEBYP
Bit 17: HSERDY
Bit 16: HSEON
Bit 15: HSICAL[7]
Bit 14: HSICAL[6]
Bit 13: HSICAL[5]
Bit 12: HSICAL[4]
Bit 11: HSICAL[3]
Bit 10: HSICAL[2]
Bit 9: HSICAL[1]
Bit 8: HSICAL[0]
Bit 7: HSITRIM[4]
Bit 6: HSITRIM[3]
Bit 5: HSITRIM[2]
Bit 4: HSITRIM[1]
Bit 3: HSITRIM[0]
Bit 2: Reserved
Bit 1: HSIRDY
Bit 0: HSION
#----------------------- "TL1" ends ----------------------

>> descriptions
Bits 31:26 Reserved, must be kept at reset value.

Bit 25 PLLRDY: PLL clock ready flag
Set by hardware to indicate that the PLL is locked.
0: PLL unlocked
1: PLL locked

Bit 24 PLLON: PLL enable
Set and cleared by software to enable PLL.
Cleared by hardware when entering Stop or Standby mode. This bit can not be reset if the PLL
clock is used as system clock or is selected to become the system clock.
0: PLL OFF
1: PLL ON

Bits 23:20 Reserved, must be kept at reset value.

Bit 19 CSSON: Clock security system enable
Set and cleared by software to enable the clock security system. When CSSON is set, the
clock detector is enabled by hardware when the HSE oscillator is ready, and disabled by
hardware if a HSE clock failure is detected.
0: Clock security system disabled (clock detector OFF).
1: Clock security system enabled (clock detector ON if the HSE is ready, OFF if not).

Bit 18 HSEBYP: HSE crystal oscillator bypass
Set and cleared by software to bypass the oscillator with an external clock. The external clock
must be enabled with the HSEON bit set, to be used by the device. The HSEBYP bit can be
written only if the HSE oscillator is disabled.
0: HSE crystal oscillator not bypassed
1: HSE crystal oscillator bypassed with external clock

Bit 17 HSERDY: HSE clock ready flag
Set by hardware to indicate that the HSE oscillator is stable. This bit needs 6 cycles of the HSE
oscillator clock to fall down after HSEON reset.
0: HSE oscillator not ready
1: HSE oscillator ready

Bit 16 HSEON: HSE clock enable
Set and cleared by software.
Cleared by hardware to stop the HSE oscillator when entering Stop or Standby mode. This bit
cannot be reset if the HSE oscillator is used directly or indirectly as the system clock.
0: HSE oscillator OFF
1: HSE oscillator ON

Bits 15:8 HSICAL[7:0]: HSI clock calibration
These bits are initialized automatically at startup. They are adjusted by SW through the
HSITRIM setting.

Bits 7:3 HSITRIM[4:0]: HSI clock trimming
These bits provide an additional user-programmable trimming value that is added to the
HSICAL[7:0] bits. It can be programmed to adjust to variations in voltage and temperature that
influence the frequency of the HSI.
The default value is 16, which, when added to the HSICAL value, should trim the HSI to 8 MHz
± 1%. The trimming step is around 40 kHz between two consecutive HSICAL steps.
Note: Increased value in the register results to higher clock frequency.

Bit 2 Reserved, must be kept at reset value.

Bit 1 HSIRDY: HSI clock ready flag
Set by hardware to indicate that HSI oscillator is stable. After the HSION bit is cleared, HSIRDY goes low after 6 HSI oscillator clock cycles.
0: HSI oscillator not ready
1: HSI oscillator ready

Bit 0 HSION: HSI clock enable
Set and cleared by software.
Set by hardware to force the HSI oscillator ON when leaving Stop or Standby mode or in case
of failure of the HSE crystal oscillator used directly or indirectly as system clock. This bit
cannot be reset if the HSI is used directly or indirectly as system clock or is selected to become
the system clock.
0: HSI oscillator OFF
1: HSI oscillator ON
----------------------------------------------------------------------------------
>> Clock configuration register (RCC_CFGR)
Address offset: 0x04
Reset value: 0x0000 0000
Access: 0 ≤ wait state ≤ 2, word, half-word and byte access
1 or 2 wait states inserted only if the access occurs during clock source switch

Bit 31: PLL_NODIV - PLL clock output bypass
Bits 30-28: MCOPRE[2:0] - Microcontroller clock output prescaler
Bits 27-24: MCO[3:0] - Microcontroller clock output selection
Bits 23-22: Reserved
Bits 21-18: PLLMUL[3:0] - PLL multiplication factor
Bit 17: PLL_XTPRE - HSE divider for PLL entry
Bits 16-15: PLL_SRC[1:0] - PLL entry clock source
Bit 14: ADC_PRE - ADC prescaler
Bits 13-11: Reserved
Bits 10-8: PPRE[2:0] - APB prescaler
Bits 7-4: HPRE[3:0] - AHB prescaler
Bits 3-2: SWS[1:0] - System clock switch status
Bits 1-0: SW[1:0] - System clock switch


Bit 31 PLLNODIV: PLL clock not divided for MCO (not available on STM32F05x devices)
This bit is set and cleared by software. It switches off divider by 2 for PLL connection to MCO.
0: PLL is divided by 2 for MCO
1: PLL is not divided for MCO

Bits 30:28 MCOPRE[2:0]: Microcontroller clock output prescaler (not available on STM32F05x devices)
These bits are set and cleared by software to select the MCO prescaler division factor. To
avoid glitches, it is highly recommended to change this prescaler only when the MCO output is
disabled.
000: MCO is divided by 1
001: MCO is divided by 2
010: MCO is divided by 4
.....
111: MCO is divided by 128

Bits 27:24 MCO[3:0]: Microcontroller clock output
Set and cleared by software.
    0000: MCO output disabled, no clock on MCO
    0001: Internal RC 14 MHz (HSI14) oscillator clock selected
    0010: Internal low speed (LSI) oscillator clock selected
    0011: External low speed (LSE) oscillator clock selected
    0100: System clock selected
    0101: Internal RC 8 MHz (HSI) oscillator clock selected
    0110: External 4-32 MHz (HSE) oscillator clock selected
    0111: PLL clock selected (divided by 1 or 2, depending on PLLNODIV)
    1000: Internal RC 48 MHz (HSI48) oscillator clock selected
Note: This clock output may have some truncated cycles at startup or during MCO clock
source switching.

Bits 23:22 Reserved, must be kept at reset value.

Bits 21:18 PLLMUL[3:0]: PLL multiplication factor
These bits are written by software to define the PLL multiplication factor. These bits can be
written only when PLL is disabled.
Caution: The PLL output frequency must not exceed 48 MHz.
    0000: PLL input clock x 2
    0001: PLL input clock x 3
    0010: PLL input clock x 4
    0011: PLL input clock x 5
    0100: PLL input clock x 6
    0101: PLL input clock x 7
    0110: PLL input clock x 8
    0111: PLL input clock x 9
    1000: PLL input clock x 10
    1001: PLL input clock x 11
    1010: PLL input clock x 12
    1011: PLL input clock x 13
    1100: PLL input clock x 14
    1101: PLL input clock x 15
    1110: PLL input clock x 16
    1111: PLL input clock x 16

Bit 17 PLLXTPRE: HSE divider for PLL input clock
This bit is the same bit as bit PREDIV[0] from RCC_CFGR2. Refer to RCC_CFGR2 PREDIV
bits description for its meaning.

Bits 16:15 PLLSRC[1:0]: PLL input clock source
Set and cleared by software to select PLL or PREDIV clock source. These bits can be written
only when PLL is disabled.
00: HSI/2 selected as PLL input clock (PREDIV forced to divide by 2 on STM32F04x,
STM32F07x and STM32F09x devices)
    01: HSI/PREDIV selected as PLL input clock
    10: HSE/PREDIV selected as PLL input clock
    11: HSI48/PREDIV selected as PLL input clock
Bit PLLSRC[0] is available only on STM32F04x, STM32F07x and STM32F09x devices,
otherwise it is reserved (with value zero).

Bit 14 ADCPRE: ADC prescaler
Obsolete setting. Proper ADC clock selection is done inside the ADC_CFGR2 (refer to
Section 13.11.5: ADC configuration register 2 (ADC_CFGR2) on page 271).
Bits 13:11 Reserved, must be kept at reset value.

Bits 10:8 PPRE[2:0]: PCLK prescaler
Set and cleared by software to control the division factor of the APB clock (PCLK).
    0xx: HCLK not divided
    100: HCLK divided by 2
    101: HCLK divided by 4
    110: HCLK divided by 8
    111: HCLK divided by 16

Bits 7:4 HPRE[3:0]: HCLK prescaler
Set and cleared by software to control the division factor of the AHB clock.
    0xxx: SYSCLK not divided
    1000: SYSCLK divided by 2
    1001: SYSCLK divided by 4
    1010: SYSCLK divided by 8
    1011: SYSCLK divided by 16
    1100: SYSCLK divided by 64
    1101: SYSCLK divided by 128
    1110: SYSCLK divided by 256
    1111: SYSCLK divided by 512

Bits 3:2 SWS[1:0]: System clock switch status
Set and cleared by hardware to indicate which clock source is used as system clock.
    00: HSI oscillator used as system clock
    01: HSE oscillator used as system clock
    10: PLL used as system clock
    11: HSI48 oscillator used as system clock (when available)

Bits 1:0 SW[1:0]: System clock switch
Set and cleared by software to select SYSCLK source.
Cleared by hardware to force HSI selection when leaving Stop and Standby mode or in case
of failure of the HSE oscillator used directly or indirectly as system clock (if the Clock Security
System is enabled).
    00: HSI selected as system clock
    01: HSE selected as system clock
    10: PLL selected as system clock
    11: HSI48 selected as system clock (when available)

----------------------------------------------------------------------------------

>> Clock interrupt register (RCC_CIR)
Address offset: 0x08
Reset value: 0x0000 0000
Access: no wait state, word, half-word and byte access


